---
layout: post
type: blog
promote: 1
status: 1
created_ts: 1292357861
changed_ts: 1292613062
node_id: 1884
title: Experimenting with Hadoop
created: '2010-12-14'
changed: '2010-12-17'
redirect_from:
- "/node/1884/"
permalink: "/2010/12/14/experimenting_hadoop/"
tags:
- Digital Preservation
---
Thanks to our [web archiving team](http://www.bl.uk/aboutus/stratpolprog/digi/webarch/) (who lead the [uk web archive project](http://www.webarchive.org.uk/ukwa/)), I was given a day of training on using [Hadoop](http://hadoop.apache.org/) today. I was already fairly familiar with the map-reduce and HDFS architecture, but I'd not had a chance to actually develop a map-reduce task or run one on a real cluster with some real data. Today's training gave me that chance, and I'm really pleased the results...
<!--break-->
Firstly, I was pleased because developing the map-reduce tasks was pretty easy. We went through the first two [Cloudera training examples](http://www.cloudera.com/downloads/virtual-machine/), and after that developing my own task took about half an hour. Furthermore, because the web archiving team were leading the training, we had a 23-node cluster with some genuine data to play with, in the form of a 50GB crawl log generated by Heretrix.

This log contained summaries of the requests and responses from a large web crawl of hundreds of millions of URLs. This log includes information on the response status codes, sizes, dates, mime-types, and so on ([see this page for details](http://crawler.archive.org/articles/user_manual/analysis.html#crawllog)). My 30-minute coding exercise simply filtered out the 125,295,840 HTTP 200 OK responses and emitted the individual mime-types during the 'map' phase, and counted up the frequency of each mime-type during the 'reduce' phase. The job took about a minute to run, and the basic results are shown below. 

The first graph shows the top ten mime-types encountered during the crawl.

<script type="text/javascript" src="//ajax.googleapis.com/ajax/static/modules/gviz/1.0/chart.js"> {"chartType":"ColumnChart","chartName":"Chart1","dataSourceUrl":"//spreadsheets.google.com/tq?key=0AsZzGhlaygesdGVrYVhUU1lQRG5OTUd5aXBtZzJ6MWc&range=A1%3AB10&gid=0&transpose=0&headers=1&pub=1","options":{"displayAnnotations":true,"showTip":true,"reverseCategories":false,"titleY":"Count","dataMode":"markers","maxAlternation":1,"pointSize":"0","colors":["#3366CC","#DC3912","#FF9900","#109618","#990099","#0099C6","#DD4477","#66AA00","#B82E2E","#316395"],"smoothLine":false,"lineWidth":"2","labelPosition":"right","is3D":false,"logScale":false,"hasLabelsColumn":true,"wmode":"opaque","title":"10 Most Popular MIME Types","legend":"none","allowCollapse":true,"reverseAxis":false,"isStacked":false,"mapType":"hybrid","width":600,"height":371},"packages":"corechart","refreshInterval":5} </script>

However, this is a little misleading, as the linear scale hides the long tail of file formats. A full chart showing all 637 mime-types in the data set requires a logarithmic vertical scale in order to be examined properly.

<script type="text/javascript" src="//ajax.googleapis.com/ajax/static/modules/gviz/1.0/chart.js"> {"chartType":"LineChart","chartName":"Chart2","dataSourceUrl":"//spreadsheets.google.com/tq?key=0AsZzGhlaygesdGVrYVhUU1lQRG5OTUd5aXBtZzJ6MWc&range=A1%3AB701&gid=0&transpose=0&headers=1&pub=1","options":{"displayAnnotations":true,"showTip":true,"reverseCategories":false,"titleY":"Count","dataMode":"markers","titleX":"MIME Type","maxAlternation":1,"pointSize":"0","colors":["#3366CC","#DC3912","#FF9900","#109618","#990099","#0099C6","#DD4477","#66AA00","#B82E2E","#316395"],"smoothLine":false,"lineWidth":"2","labelPosition":"right","is3D":false,"logScale":true,"hasLabelsColumn":true,"wmode":"opaque","title":"Full MIME Type Distribution (Log Scale)","legend":"none","allowCollapse":true,"reverseAxis":false,"isStacked":false,"mapType":"hybrid","width":600,"height":371},"packages":"corechart","refreshInterval":5} </script>

So, we find that although the set is dominated by a few main formats, the problem is that the long-tail of minor formats still makes up a significant proportion of the overall data set. About 66% of the file are HTML, and the ten most popular types combined make up about 90% of the content. The remaining 10% is made up of the other 627 mime-types, which makes it very difficult to deal with.

I'm sure this is just reproducing some well-known findings in the field, but that's not really the point. The point is that, once the Hadoop infrastructure is in place, these kind of explorations are very quick, easy, and great fun to do.

(Updated: Re-ran experiment and analysis, correcting for non lower-case MIME type.)
